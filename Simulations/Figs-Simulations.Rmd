---
author: "Hector Roux de BÃ©zieux"
date: '`r format(Sys.time(), "%d %B , %Y")`'
title: 'Results on simulation data'
output:
  html_document:
    toc: true
    toc_float: TRUE
    toc_depth: 2
    number_sections: true
    code_download: TRUE
---

```{r load packages, include=F}
library(knitr)
opts_chunk$set(
  fig.pos = "!h", out.extra = "", warning = F, message = F,
  fig.align = "center", echo = F
)
libs <- c("here", "dplyr", "ggplot2", "tidyr", "stringr", "readr", "cowplot",
          "mclust", "RColorBrewer", "purrr", "Dune", "pracma", "purrr",
          "DailyHRB", "patchwork")
suppressMessages(
  suppressWarnings(sapply(libs, require, character.only = TRUE))
)
rm(libs)
```

# Results for all 40
## Finding where Dune stops

```{r}
res <- lapply(1:4, function(id){
  df <- read.csv(here("Simulations", "Data", paste0("Metric_Ref_", id, ".csv")))
  return(df)
})

min_ns <- lapply(res, function(df){
  df %>% filter(method %in% c("Dune", "Dune_NMI")) %>%
    group_by(method, clustering) %>%
    filter(n_clus == min(n_clus)) %>%
    select(method, n_clus, clustering) %>%
    distinct() %>%
    return()
}) %>% 
  bind_rows(.id = "Dataset") %>%
  mutate(method = if_else(str_detect(method, "NMI"), "NMI", "ARI"))
p1 <- ggplot(min_ns, aes(x = Dataset, y = n_clus, col = method)) +
  geom_jitter(width = .1, height = 0) +
  theme_bw() +
  scale_color_viridis_d() +
  labs(col = "Merging metric", y = "Number of clusters") +
  geom_hline(yintercept = 30, col = "darkred") +
  annotate("text", y = 31.5, x = 4, label = "True number\nof clusters",
           col = "darkred")
p2 <- ggplot(min_ns, aes(x = Dataset, y = n_clus, col = clustering)) +
  geom_jitter(width = .1, height = 0) +
  theme_bw() +
  scale_color_viridis_d() +
  labs(col = "Merging metric", y = "Number of clusters") +
  geom_hline(yintercept = 30, col = "darkred") +
  annotate("text", y = 31.5, x = 4, label = "True number\nof clusters",
           col = "darkred")

p1 / p2
```

## Comparison with the truth

```{r}
res <- bind_rows(res, .id = "Dataset") %>%
  filter(method != "param") %>%
  # group_by(Metric, Dataset, ) %>%
  filter(n_clus >= 20)
ggplot(res, aes(x = n_clus, y = Value, col = method)) +
  facet_wrap(~ Metric + Dataset + clustering, scales = "free_y") +
  geom_path() +
  theme_bw()
  
```
